<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>F5 BIG-IP LTM命令行配置</title>
    <url>/posts/dbaf3e89.html</url>
    <content><![CDATA[<p>此文档记录下一些LTM常用的Tmsh操作命令。持续更新中</p>
<span id="more"></span>





<h2 id="配置MGMT"><a href="#配置MGMT" class="headerlink" title="配置MGMT"></a>配置MGMT</h2><ul>
<li>管理口关闭DHCP</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">modify sys global-settings mgmt-dhcp disabled</span><br></pre></td></tr></table></figure>

<ul>
<li>配置管理地址</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create sys management-ip 10.10.10.2/24</span><br></pre></td></tr></table></figure>

<ul>
<li>配置带外网络路由,一般不建议配置默认路由</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create sys management-route MGMT_route network 10.10.11.0/24 gateway 10.10.10.1</span><br></pre></td></tr></table></figure>

<h2 id="安装license"><a href="#安装license" class="headerlink" title="安装license"></a>安装license</h2><ul>
<li>安装License</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">install sys license registration-key XXXX-XXXX-XXXX-XXXX-XXXX</span><br></pre></td></tr></table></figure>

<blockquote>
<p>tips: <em>XXXX-XXXX-XXXX-XXXX-XXXX</em>为License，激活后  <em>(NO LICENSE)</em> 会变为 <em>(Active)</em>,至此激活完成。</p>
</blockquote>
<h2 id="修改系统名称"><a href="#修改系统名称" class="headerlink" title="修改系统名称"></a>修改系统名称</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">modify sys global-settings hostname node01.f5.com</span><br></pre></td></tr></table></figure>

<h2 id="修改时钟源-x2F-时区"><a href="#修改时钟源-x2F-时区" class="headerlink" title="修改时钟源&#x2F;时区"></a>修改时钟源&#x2F;时区</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">modify sys ntp servers add &#123; 10.10.10.1 &#125;</span><br><span class="line">modify sys ntp timezone Asia/Shanghai</span><br></pre></td></tr></table></figure>

<h2 id="关闭web图形化引导"><a href="#关闭web图形化引导" class="headerlink" title="关闭web图形化引导"></a>关闭web图形化引导</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">modify sys global-settings gui-setup disabled</span><br></pre></td></tr></table></figure>

<h2 id="修改web页面登录密码"><a href="#修改web页面登录密码" class="headerlink" title="修改web页面登录密码"></a>修改web页面登录密码</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">modify auth user admin password &quot;password&quot;</span><br></pre></td></tr></table></figure>

<h2 id="修改设备名称"><a href="#修改设备名称" class="headerlink" title="修改设备名称"></a>修改设备名称</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mv cm device bigip1 node01.f5.com</span><br></pre></td></tr></table></figure>

<h2 id="开启LLDP"><a href="#开启LLDP" class="headerlink" title="开启LLDP"></a>开启LLDP</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">modify net lldp-globals enabled</span><br></pre></td></tr></table></figure>

<h2 id="组建HA"><a href="#组建HA" class="headerlink" title="组建HA"></a>组建HA</h2><ul>
<li>分别在两台设备上创建用作HA的接口的相关配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">node01</span><br><span class="line">create net trunk trunk_ha interfaces add &#123; 1.1 1.2 &#125;</span><br><span class="line">create net vlan vlan_ha tag 4094 interfaces add &#123; trunk_ha &#125;</span><br><span class="line">create net self Selfip_HA address 1.1.1.1/30 traffic-group traffic-group-local-only  vlan vlan_ha allow-service all</span><br><span class="line"></span><br><span class="line">node02</span><br><span class="line">create net trunk trunk_ha interfaces add &#123; 1.1 1.2 &#125;</span><br><span class="line">create net vlan vlan_ha tag 4094 interfaces add &#123; trunk_ha &#125;</span><br><span class="line">create net self Selfip_HA address 1.1.1.2/30 traffic-group traffic-group-local-only  vlan vlan_ha allow-service all</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>修改设备同步配置所用地址</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">node01</span><br><span class="line">modify cm device node01.com configsync-ip 1.1.1.1 mirror-ip 1.1.1.1 unicast-address &#123; &#123; ip 1.1.1.1 &#125; &#125;</span><br><span class="line"></span><br><span class="line">node02</span><br><span class="line">modify cm device node02.com configsync-ip 1.1.1.2 mirror-ip 1.1.1.2 unicast-address &#123; &#123; ip 1.1.1.2 &#125; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>添加同步信任设备</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">node01</span><br><span class="line">run cm add-to-trust ca-device device 1.1.1.2 device-name node02.f5.com username admin password &quot;password&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建设备同步组,<em>HA_group</em>为自定义命名</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create cm device-group Group_HA auto-sync disabled devices add &#123; node01.f5.com node02.f5.com &#125; type sync-failover</span><br></pre></td></tr></table></figure>

<ul>
<li>创建流量同步组</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">modify cm traffic-group traffic-group-1 ha-order &#123; node01.f5.com node02.f5.com &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>同步配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">run cm config-sync Group_HA </span><br></pre></td></tr></table></figure>

<ul>
<li>主备切换</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">run sys failover standby</span><br></pre></td></tr></table></figure>

<blockquote>
<p>tips：在主节点执行此命令</p>
</blockquote>
<h2 id="接口配置聚合"><a href="#接口配置聚合" class="headerlink" title="接口配置聚合"></a>接口配置聚合</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create net trunk trunk_YW interfaces add &#123; 1.3 1.4 &#125; lacp enabled lacp-mode active</span><br></pre></td></tr></table></figure>

<blockquote>
<p>tips: <em>trunk_YW</em>为自定义名称</p>
</blockquote>
<h2 id="查看Trunk相关配置"><a href="#查看Trunk相关配置" class="headerlink" title="查看Trunk相关配置"></a>查看Trunk相关配置</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">list net trunk</span><br></pre></td></tr></table></figure>

<h2 id="创建vlan"><a href="#创建vlan" class="headerlink" title="创建vlan"></a>创建vlan</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create net vlan vlan_1000 tag 1000 interfaces add &#123; trunk_YW &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>tips: <em>vlan_1000</em>为自定义名称 <em>trunk_YW</em>为关联的接口</p>
</blockquote>
<h2 id="查看vlan相关配置"><a href="#查看vlan相关配置" class="headerlink" title="查看vlan相关配置"></a>查看vlan相关配置</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">list net vlan</span><br></pre></td></tr></table></figure>

<h2 id="创建Self地址"><a href="#创建Self地址" class="headerlink" title="创建Self地址"></a>创建Self地址</h2><ul>
<li>创建IPv4 self IP</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create net self Selfip_10.10.10.2 address 10.10.10.2/24 vlan vlan_1000 traffic-group traffic-group-local-only allow-service default</span><br></pre></td></tr></table></figure>

<ul>
<li>创建IPv6 self IP</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create net self Selfip_v6_10.10.10.2 address fd00:1::10:10:10:2/64 vlan vlan_1000 traffic-group traffic-group-local-only allow-service default</span><br></pre></td></tr></table></figure>

<ul>
<li>查看self ip</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">list net self</span><br></pre></td></tr></table></figure>

<h2 id="创建Floating-IP"><a href="#创建Floating-IP" class="headerlink" title="创建Floating IP"></a>创建Floating IP</h2><ul>
<li>创建IPv4 Floating IP</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create net self Floatingip_10.10.10.1 address 10.10.10.1/24 vlan vlan_1000 traffic-group traffic-group-1 allow-service default</span><br></pre></td></tr></table></figure>

<ul>
<li>创建IPv6 Floating IP</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create net self Floatingip_v6_10.10.10.1 address fd00:1::10:10:10:1/64 vlan vlan_1000 traffic-group traffic-group-1 allow-service default</span><br></pre></td></tr></table></figure>

<ul>
<li>查看Floating IP</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">list net self floating	</span><br></pre></td></tr></table></figure>

<h2 id="创建静态路由"><a href="#创建静态路由" class="headerlink" title="创建静态路由"></a>创建静态路由</h2><ul>
<li>创建IPv4 静态路由</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create net route Internet_telecom network 0.0.0.0/0 gw 192.168.1.1 mtu 1500 </span><br></pre></td></tr></table></figure>

<ul>
<li>创建IPv6 静态路由</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create net route Internet_telecom network ::/0 gw fd00:1::192:168:1:1 mtu 1500 </span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips: gw也可以使用pool的方式，前提需要创建node，pool并设置优先级</p>
</blockquote>
<h2 id="创建node"><a href="#创建node" class="headerlink" title="创建node"></a>创建node</h2><ul>
<li>创建IPv4 node</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create ltm node 192.168.10.1 address 192.168.10.1 monitor icmp</span><br></pre></td></tr></table></figure>

<ul>
<li>创建IPv6 node</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create ltm node v6_192.168.10.1 address fd00:1::192:168:10:1/64 monitor icmp</span><br></pre></td></tr></table></figure>

<ul>
<li>查看node</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">list ltm node</span><br></pre></td></tr></table></figure>

<h2 id="创建pool"><a href="#创建pool" class="headerlink" title="创建pool"></a>创建pool</h2><ul>
<li>创建IPv4 pool</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create ltm pool pool_192.168.10.1 members add &#123; 192.168.10.1:any &#125;  monitor gateway_icmp</span><br></pre></td></tr></table></figure>

<ul>
<li>创建IPv6 pool</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create ltm pool v6_pool_192.168.10.1 members add &#123; fd00:1::192:168:10:1:any &#125;  monitor gateway_icmp</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips: pool的名字为自定义，pool members可以跟多个，monitor可以根据需求选择。删除使用delete命令，修改使用modify命令。</p>
</blockquote>
<ul>
<li>查看pool</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">list ltm pool</span><br></pre></td></tr></table></figure>

<h2 id="创建VS"><a href="#创建VS" class="headerlink" title="创建VS"></a>创建VS</h2><ul>
<li>创建IPv4 VS</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create ltm virtual vs_192.168.10.1 source 0.0.0.0/0 destination 192.168.11.1:8080 ip-protocol tcp pool pool_192.168.10.1 profiles add &#123; fastL4 &#125; persist replace-all-with &#123; source_addr &#123; default yes &#125; &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建IPv6 VS</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create ltm virtual vs_v6_192.168.10.1 source ::/0 destination fd00:1::192:168:11:1:8080 ip-protocol tcp pool v6_pool_192.168.10.1 profiles add &#123; fastL4 &#125; persist replace-all-with &#123; source_addr &#123; default yes &#125; &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>查看pool</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">list ltm virtual</span><br></pre></td></tr></table></figure>

<ul>
<li>创建vs forwarding(承载路由情况下)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create ltm virtual vs_forwarding source 0.0.0.0/0 destination 0.0.0.0:any ip-forward profiles add &#123; fastL4 &#125;</span><br></pre></td></tr></table></figure>

<h2 id="路由域方式"><a href="#路由域方式" class="headerlink" title="路由域方式"></a>路由域方式</h2><ul>
<li>创建路由域并指定vlan</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create net route-domain APP id 1 vlans add &#123; vlan_1000 &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips: APP为自定义名称 id必须为数字</p>
</blockquote>
<ul>
<li>创建静态路由</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create net route 0.0.0.0%1/0 gw 192.168.1.1%1 mtu 1500 </span><br></pre></td></tr></table></figure>

<ul>
<li>创建Self IP</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create net self Selfip_10.10.10.2 address 10.10.10.2%1/24 vlan vlan_1000 traffic-group traffic-group-local-only allow-service default</span><br></pre></td></tr></table></figure>

<ul>
<li>创建Floating IP</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create net self Floatingip_10.10.10.1 address 10.10.10.1%1/24 vlan vlan_1000 traffic-group traffic-group-1 allow-service default</span><br></pre></td></tr></table></figure>

<ul>
<li>创建node</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create ltm node 192.168.10.1%1 address 192.168.10.1%1 monitor icmp</span><br></pre></td></tr></table></figure>

<ul>
<li>创建pool</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create ltm pool pool_192.168.10.5 members add &#123; 192.168.10.5%1:any &#125; monitor gateway_icmp</span><br></pre></td></tr></table></figure>

<ul>
<li>创建VS</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create ltm virtual vs_192.168.11.5 source 0.0.0.0%1/0 destination 192.168.11.5%1:any ip-protocol tcp pool pool_192.168.10.5 profiles add &#123; fastL4 &#125; persist replace-all-with &#123; source_addr &#123; default yes &#125; &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>创建VS fowarding</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create ltm virtual vs_forwarding source 0.0.0.0%1/0 destination 0.0.0.0%1:any ip-forward profiles add &#123; fastL4 &#125;</span><br></pre></td></tr></table></figure>

<h2 id="版本升级"><a href="#版本升级" class="headerlink" title="版本升级"></a>版本升级</h2><ul>
<li>通过Windows进行镜像上传,在镜像所在目前执行以下命令，前提是Windows开启了SSH</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">scp 镜像名称 root@F5设备IP:/shared/images/</span><br></pre></td></tr></table></figure>

<ul>
<li>如果是Linux系统可以执行上面的命令，也可以在F5设备上执行以下命令</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">scp root@Linux系统IP:/镜像所在目录 /shared/images/</span><br></pre></td></tr></table></figure>

<ul>
<li>U盘拷贝</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">df -h //可以看出U盘位置，一般是sdb1</span><br><span class="line">mkdir /mnt/ios //创建挂载目录</span><br><span class="line">mount /dev/sdb1 /mnt/ios/ //挂在目录</span><br><span class="line">cp -r /mnt/ios/镜像名称 /shared/images/  //拷贝镜像</span><br><span class="line">umount /mnt/ios //卸载U盘</span><br></pre></td></tr></table></figure>

<ul>
<li>校验MD5值</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">md5sum 镜像文件名</span><br></pre></td></tr></table></figure>

<ul>
<li>查看系统版本情况</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show sys software</span><br></pre></td></tr></table></figure>

<ul>
<li>安装镜像至新的分区</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tmsh install sys software images 镜像文件名 volume HD1.X create-volume</span><br></pre></td></tr></table></figure>

<ul>
<li>查看安装进度</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">watch tmsh show sys software</span><br></pre></td></tr></table></figure>

<ul>
<li>查看整体日志</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tail -f var/log/liveinstall.log</span><br></pre></td></tr></table></figure>

<ul>
<li>设置F5系统至新的分区，并重启系统完成升级</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">switchboot -b HD1.x</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>负载均衡</category>
      </categories>
      <tags>
        <tag>F5</tag>
        <tag>LTM</tag>
      </tags>
  </entry>
</search>
